---

- name: "User: add jenkins user"
  become: yes
  user:
    name=jenkins

- name: "User: download authorized key"
  get_url:
    url=https://raw.githubusercontent.com/plone/jenkins.plone.org/master/jenkins.plone.org.pub
    dest=/tmp/jenkins.authorized_keys
  delegate_to: 127.0.0.1

- name: "User: install authorized key"
  become: yes
  become_user: jenkins
  authorized_key:
    user=jenkins
    key="{{ lookup('file', '/tmp/jenkins.authorized_keys') }}"

- name: "User: git config"
  become: yes
  become_user: jenkins
  copy:
    src=gitconfig
    dest=/home/jenkins/.gitconfig
    owner=jenkins
    group=jenkins

- name: "User: create .buildout main folder"
  become: yes
  become_user: jenkins
  file:
    path=/home/jenkins/.buildout
    state=directory
    owner=jenkins
    group=jenkins

- name: "User: create .buildout subfolders"
  become: yes
  become_user: jenkins
  file:
    path=/home/jenkins/.buildout/{{ item }}
    state=directory
    owner=jenkins
    group=jenkins
  with_items:
    - eggs
    - downloads
    - extends
    - cache

- name: "User: add default.cfg buildout config file"
  become: yes
  become_user: jenkins
  copy:
    src=default.cfg
    dest=/home/jenkins/.buildout/default.cfg
    owner=jenkins
    group=jenkins
